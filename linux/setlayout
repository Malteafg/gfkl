#!/bin/sh

CACHE_LOC="$HOME/.cache/gfkl"

chosen=""

while getopts ":wuvd" opt; do
    case $opt in
        w) chosen="wokmok";;
        u) chosen="us-intl";;
        v) chosen="voyager";;
        d) chosen="danish";;
        \?)
            echo "Invalid option: -$OPTARG" >&2
            exit
            ;;
    esac
done

if [[ $# -eq 0 ]] ; then
    echo "Usage: -w for wokmok, -u for us intl., -v for voyager, -d for danish"
    exit 0
fi

killall -q xcape

case "$chosen" in
    "wokmok") 
        setxkbmap -layout gfkl -model pc105
        xcape -e '#66=Escape;#36=Return;#64=F12;#65=space' -t 180
        echo "wokmok" > "$CACHE_LOC";;
    "us-intl")
        # setxkbmap -layout us -variant altgr-intl -model pc105 -option altwin:swap_lalt_lwin
        setxkbmap -layout us -variant altgr-intl -model pc105
        xcape -e '#64=F12' -t 180
        echo "us-intl" > "$CACHE_LOC";;
    "voyager")
        setxkbmap -layout us -variant altgr-intl -model pc105
        echo "voyager" > "$CACHE_LOC";;
    "danish")
        # setxkbmap -layout dk -model pc105 -option altwin:swap_lalt_lwin
        setxkbmap -layout dk -model pc105
        xcape -e '#64=F12' -t 180
        echo "danish" > "$CACHE_LOC";;
esac
